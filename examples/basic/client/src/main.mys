from argparse import Parser
from dbus import SessionBus
from dbus.types import Double
from fiber import sleep
from .dbus_basic_client import BasicDemoInterface
from .dbus_basic_client import BasicObject

class BasicDemo(BasicDemoInterface):

    def count(self, value: i64):
        print(f"Count: {value}")

def main(argv: [string]):
    parser = Parser()
    parser.add_option("--exit")
    args = parser.parse(argv)

    bus = SessionBus()
    basic_1 = BasicObject("com.example.Basic", "/Basic1", BasicDemo())
    bus.add_object_client(basic_1)
    bus.start()

    print(basic_1.random())
    print(basic_1.hello("Hello!"))
    print(basic_1.echo(Double(5.0)))
    print(basic_1.cat(__file__))
    print(basic_1.sum([1, 2]))
    print(basic_1.info())

    if args.is_present("--exit"):
        print(basic_1.exit())
    else:
        sleep(10.0)

    bus.stop()
    bus.join()
